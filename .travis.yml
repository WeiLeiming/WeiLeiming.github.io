language: node_js
node_js: stable

before_install:
  - npm install hexo-cli -g

install:
  - npm install

script:
  - hexo clean
  - hexo generate

after_script:
  #- cd ./public
  #- git init
  #- git config user.name "WillWei"
  #- git config user.email "2008weileiming@gmail.com"
  #- git add .
  #- git commit -m "update blog - auto deploy by Travis CI."
  #- git push --force --quiet "https://${GH_TOKEN}@${GH_REF}" master:master

  - git config --global user.name "WillWei"
  - git config --global user.email "2008weileiming@gmail.com"
  - git clone https://${GH_REF} .deploy_git
  - cd .deploy_git
  - git checkout master
  - cd ../
  - sed -i'' "s~${GH_REF}~${GH_TOKEN}:x-oauth-basic@${GH_REF}~" _config.yml
  - hexo d > log.txt 2>&1
  - cat log.txt | sed "s~${GH_TOKEN}~TOKEN~g"

branches:
  only:
    - source
env:
 global:
   - GH_REF: github.com/weileiming/weileiming.github.io.git
